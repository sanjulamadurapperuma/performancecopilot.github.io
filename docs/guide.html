<!DOCTYPE html>
<html>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='initial-scale=1' name='viewport'>
<title>Performance Co-Pilot</title>
<link href='/assets/css/screen.css' media='all' rel='stylesheet' type='text/css'>
<link href='/assets/css/master.css' media='all' rel='stylesheet' type='text/css'>
<link href='/images/pcp.ico' rel='shortcut icon' type='image/ico'>

</head>
<body>
<header class='global-header'>
<div class='row'>
<h1 class='global-logo colspan12-6 colspan8-4 colspan6-3 colspan2-1 as-grid'>
<a href='/index.html'>Performance Co-Pilot</a>
</h1>
<nav class='global-header__navigation colspan12-6 colspan8-6 colspan6-4 colspan2-1 as-grid'>
<ul>
<li>
<a href='/features.html'>Features</a>
</li>
<li>
<a href='/documentation.html'>Documentation</a>
</li>
<li>
<a href='/download.html'>Download</a>
</li>
<li>
<a href='/community.html'>Get Involved</a>
</li>
</ul>
</nav>
</div>
</header>

<div class='site-content'>
<div class='how-to is-typeset'>
<div class='row-parent'>
<div class='row'>
<div class='docpage'>
﻿
 <h1 align="CENTER" style="margin-top: 0.48cm; margin-bottom: 0.32cm">
  <font size="7">
   PCP Quick Reference Guide
  </font>
 </h1>
 <ul>
  <li>
   <a href="#intro">
    Introduction
   </a>
  </li>
  <li>
   <a href="#install">
    Installation
   </a>
   <ul>
    <li>
     <a href="#collectors">
      Installing Collector Hosts
     </a>
    </li>
    <li>
     <a href="#monitors">
      Installing Monitor Hosts
     </a>
    </li>
    <li>
     <a href="#discovery">
      Dynamic Host Discovery
     </a>
    </li>
    <li>
     <a href="#healthcheck">
      Installation Health Check
     </a>
    </li>
   </ul>
  </li>
  <li>
   <a href="#systemlevel">
    System Level Performance Monitoring
   </a>
   <ul>
    <li>
     <a href="#live">
      Monitoring Live Performance Metrics
     </a>
    </li>
    <li>
     <a href="#retro">
      Retrospective Performance Analysis
     </a>
    </li>
    <li>
     <a href="#visual">
      Visualizing iostat and sar Data
     </a>
    </li>
   </ul>
  </li>
  <li>
   <a href="#processes">
    Process Level Performance Monitoring
   </a>
   <ul>
    <li>
     <a href="#processmon">
      Live and Retrospective Process Monitoring
     </a>
    </li>
    <li>
     <a href="#hotproc">
      Monitoring “Hot” Processes with Hotproc
     </a>
    </li>
    <li>
     <a href="#instrument">
      Application Instrumentation
     </a>
    </li>
   </ul>
  </li>
  <li>
   <a href="#pmie">
    Performance Metrics Inference
   </a>
  </li>
  <li>
   <a href="#pmseries">
    Fast, Scalable Time Series Querying
   </a>
  </li>
  <li>
   <a href="#web">
    Web Services
   </a>
   <ul>
    <li>
     <a href="#pmproxy">
      Performance Metrics REST APIs
     </a>
    </li>
    <li>
     <a href="#grafana">
      Web Interface for Performance Metrics
     </a>
    </li>
   </ul>
  </li>
  <li>
   <a href="#derived">
    Derived Metrics
   </a>
  </li>
  <li>
   <a href="#custom">
    Customizing and Extending PCP
   </a>
  </li>
  <li>
   <a href="#next">
    Additional Information
   </a>
  </li>
 </ul>
 <a name="intro">
 </a>
 <h1>
  Introduction
 </h1>
 <p>
  <a href="https://pcp.io/">
   Performance Co-Pilot
  </a>
  (PCP) is an open source framework and toolkit for monitoring, analyzing, and responding to details of live and historical system performance. PCP has a fully distributed, plug-in based architecture making it particularly well suited to centralized analysis of complex environments and systems. Custom performance metrics can be added using the C, C++, Perl, and Python interfaces.
 </p>
 <p>
  This page provides quick instructions how to install and use PCP on a set of hosts of which one (a monitor host) will be used for monitoring and analyzing itself and other hosts (collector hosts).
  <a name="install">
  </a>
 </p>
 <h1>
  Installation
 </h1>
 <p>
  PCP is available on all recent Linux distribution releases, including Debian/Fedora/RHEL/SUSE/Ubuntu. For other operating systems and distributions you might want to consider installation
  <a href="https://github.com/performancecopilot/pcp/blob/master/INSTALL.md">
   from sources
  </a>
  .
  <a name="collectors">
  </a>
 </p>
 <h3>
  Installing Collector Hosts
 </h3>
 <table border="0" cellpadding="10" cellspacing="20" width="100%">
  <tr>
   <td width="70%">
    <br/>
    To install basic PCP tools and services and enable collecting performance data on systemd based distributions, run:
    <br/>
    <b>
     <br/>
     # yum install pcp # or apt-get or dnf or zypper
     <br/>
     # systemctl enable pmcd
     <br/>
     # systemctl start pmcd
     <br/>
     # systemctl enable pmlogger
     <br/>
     # systemctl start pmlogger
    </b>
   </td>
  </tr>
 </table>
 <p>
  Here we enable the Performance Metrics Collector Daemon (
  <a href="/man/man1/pmcd.1.html">
   pmcd(1)
  </a>
  ) on the host which then in turn will control and request metrics on behalf of clients from various Performance Metrics Domain Agents (PMDAs). The PMDAs provide the actual data from different components (domains) in the system, for example from the Linux Kernel PMDA or the NFS Client PMDA. The default configuration includes over 1000 metrics with negligible overall overhead when queried. If no queries for metrics are sent to the agent, it doesn't do anything at all. Local PCP archive logs will also be enabled on the host for convenience with
  <a href="/man/man1/pmlogger.1.html">
   pmlogger(1)
  </a>
  .
 </p>
 <table border="0" cellpadding="10" cellspacing="20" width="100%">
  <tr>
   <td width="70%">
    <br/>
    To enable PMDAs which are not enabled by default, for example the PostgreSQL database PMDA, run the corresponding Install script:
    <br/>
    <b>
     <br/>
     # cd /var/lib/pcp/pmdas/postgresql
     <br/>
     # ./Install
    </b>
   </td>
  </tr>
 </table>
 <p>
  The client tools will contact local or remote PMCDs as needed, communication with PMCD over the network uses TCP port 44321 by default.
  <a name="monitors">
  </a>
 </p>
 <h3>
  Installing Monitor Host
 </h3>
 <p>
  The following additional packages can be optionally installed on the monitoring host to extend the set of monitoring tools from the base pcp package.
 </p>
 <table border="0" cellpadding="10" cellspacing="20" width="100%">
  <tr>
   <td width="70%">
    <br/>
    Install various system monitoring tools, graphical analysis tools, and documentation:
    <br/>
    <b>
     <br/>
     # yum install pcp-doc pcp-gui pcp-system-tools # or apt-get or dnf or zypper
    </b>
   </td>
  </tr>
 </table>
 <p>
  To enable centralized archive log collection on the monitoring host, its pmlogger is configured to fetch performance metrics from collector hosts. Add each collector host to the pmlogger configuration file
  <tt>
   /etc/pcp/pmlogger/control
  </tt>
  and then restart the pmlogger service on the monitoring host.
 </p>
 <table border="0" cellpadding="10" cellspacing="20" width="100%">
  <tr>
   <td width="70%">
    <br/>
    Enable recording of metrics from remote host
    <b>
     acme.com
    </b>
    :
    <b>
     <br/>
     <br/>
     # echo acme.com n n PCP_LOG_DIR/pmlogger/acme.com -r -T24h10m -c config.acme.com &gt;&gt; /etc/pcp/pmlogger/control
     <br/>
     <br/>
     # systemctl restart pmlogger
    </b>
   </td>
  </tr>
 </table>
 <p>
  The health of the remote log collector will be done every half an hour. You can also run
  <kbd>
   /usr/libexec/pcp/bin/pmlogger_check -V -C
  </kbd>
  (on Fedora/RHEL) or
  <kbd>
   /usr/lib/pcp/bin/pmlogger_check -V -C
  </kbd>
  (on Debian/Ubuntu) manually to do a health check.
 </p>
 <p>
  Note that a default configuration file (config.acme.com above) will be generated if it does not exist already. This process is optional (a custom configuration for each host can be provided instead), see the
  <a href="/man/man1/pmlogconf.1.html">
   pmlogconf(1) manual page
  </a>
  for details on this.
  <a name="discovery">
  </a>
 </p>
 <h3>
  Dynamic Host Discovery
 </h3>
 <p>
  In dynamic environments manually configuring every host is not feasible, perhaps even impossible. PCP Manager (
  <a href="/man/man1/pmmgr.1.html">
   pmmgr(1)
  </a>
  , from the pcp-manager package) can be used instead of directly invoking pmlogger to auto-discover and auto-configure new collector hosts.
 </p>
 <table border="0" cellpadding="10" cellspacing="20" width="100%">
  <tr>
   <td width="70%">
    <br/>
    To install the PMMGR daemon and begin monitoring either statically or dynamically configured hosts, run:
    <br/>
    <b>
     <br/>
     # yum install pcp-manager # or apt-get or dnf or zypper
     <br/>
     # systemctl enable pmmgr
     <br/>
     # echo acme.com &gt;&gt; /etc/pcp/pmmgr/target-host
     <br/>
     # echo avahi &gt;&gt; /etc/pcp/pmmgr/target-discovery
     <br/>
     # echo probe=
     <font>
      ip.addr.tup.le/netmask
     </font>
     &gt;&gt; /etc/pcp/pmmgr/target-discovery
     <br/>
     # systemctl restart pmmgr
     <br/>
     # find /var/log/pcp/pmmgr
    </b>
   </td>
  </tr>
 </table>
 <table border="0" cellpadding="10" cellspacing="20" width="100%">
  <tr>
   <td width="70%">
    <br/>
    Discover use of the PCP pmcd service on the local network:
    <br/>
    <b>
     <br/>
     $
     <a href="/man/man1/pmfind.1.html">
      pmfind
     </a>
     -s pmcd
    </b>
   </td>
  </tr>
 </table>
 <a name="healthcheck">
 </a>
 <h3>
  Installation Health Check
 </h3>
 <p>
  Basic health check for running services, network connectivity between hosts, and enabled PMDAs can be done simply as follows.
 </p>
 <table border="0" cellpadding="10" cellspacing="20" width="100%">
  <tr>
   <td width="70%">
    <br/>
    Check PCP services on remote host
    <b>
     <font>
      munch
     </font>
    </b>
    and historically, from a local archive for host
    <b>
     <font>
      smash
     </font>
    </b>
    :
    <br/>
    <b>
     <br/>
     $
     <a href="/man/man1/pcp.1.html">
      pcp
     </a>
     -h
     <font>
      munch
     </font>
    </b>
    <pre>
Performance Co-Pilot configuration on munch:
  platform: SunOS munch 5.11 oi_151a8 i86pc
  hardware: 4 cpus, 3 disks, 4087MB RAM
  timezone: EST-10
  services: pmcd pmproxy
      pmcd: Version 5.0.0-1, 3 agents
      pmda: pmcd mmv solaris
      pmie: /var/log/pcp/pmie/munch/pmie.log
</pre>
    <b>
     <br/>
     $
     <a href="/man/man1/pcp.1.html">
      pcp
     </a>
     -a /var/log/pcp/pmlogger/
     <font>
      smash
     </font>
     /20140729
    </b>
    <pre>
Performance Co-Pilot configuration on smash:
   archive: /var/log/pcp/pmlogger/smash/20190909
  platform: Linux smash 2.6.32-279.46.1.el6.x86_64 #1 SMP Mon May 19 16:16:00 EDT 2014 x86_64
  hardware: 8 cpus, 2 disks, 1 node, 23960MB RAM
  timezone: EST-10
  services: pmcd pmproxy
      pmcd: Version 5.0.0-1, 8 agents
      pmda: pmcd proc xfs linux mmv nvidia dmcache postgresql
  pmlogger: primary logger: /var/log/pcp/pmlogger/smash/20190909.00.10
      pmie: /var/log/pcp/pmie/smash/pmie.log
</pre>
   </td>
  </tr>
 </table>
 <a name="systemlevel">
 </a>
 <h1>
  System Level Performance Monitoring
 </h1>
 <p>
  PCP comes with a wide range of command line utilities for accessing live performance metrics via PMCDs or historical data using archive logs. The following examples illustrate some of the most useful use cases, please see the corresponding manual pages for each command for additional information. In the examples below
  <b>
   -h &lt;host&gt;
  </b>
  could be used to query a remote host, the default is the local host. Shell completion support for Bash and especially for Zsh allows completing available metrics, metricsets (with
  <a href="/man/man1/pmrep.1.html">
   pmrep
  </a>
  ), and available command line options.
  <a name="live">
  </a>
 </p>
 <h3>
  Monitoring Live Performance Metrics
 </h3>
 <table border="0" cellpadding="10" cellspacing="20" width="100%">
  <tr>
   <td width="70%">
    <br/>
    Display all the enabled performance metrics on a host with a short description:
    <br/>
    <b>
     <br/>
     $
     <a href="/man/man1/pminfo.1.html">
      pminfo
     </a>
     -t
    </b>
   </td>
  </tr>
 </table>
 <table border="0" cellpadding="10" cellspacing="20" width="100%">
  <tr>
   <td width="70%">
    <br/>
    Display detailed information about a performance metric and its current values:
    <br/>
    <b>
     <br/>
     $
     <a href="/man/man1/pminfo.1.html">
      pminfo
     </a>
     -dfmtT disk.partitions.read
    </b>
   </td>
  </tr>
 </table>
 <table border="0" cellpadding="10" cellspacing="20" width="100%">
  <tr>
   <td width="70%">
    <br/>
    Monitor live disk write operations per partition with two second interval using fixed point notation (use
    <em>
     -i
    </em>
    instance to list only certain metrics and
    <em>
     -r
    </em>
    for raw values):
    <br/>
    <b>
     <br/>
     $
     <a href="/man/man1/pmval.1.html">
      pmval
     </a>
     -t 2sec -f 3 disk.partitions.write
    </b>
   </td>
  </tr>
 </table>
 <table border="0" cellpadding="10" cellspacing="20" width="100%">
  <tr>
   <td width="70%">
    <br/>
    Monitor live CPU load, memory usage, and disk write operations per partition with two second interval using fixed width columns on the remote host acme:
    <br/>
    <b>
     <br/>
     $
     <a href="/man/man1/pmdumptext.1.html">
      pmdumptext
     </a>
     -Xlimu -t 2sec 'kernel.all.load[1]' mem.util.used disk.partitions.write -h acme.com
    </b>
   </td>
  </tr>
 </table>
 <table border="0" cellpadding="10" cellspacing="20" width="100%">
  <tr>
   <td width="70%">
    <br/>
    Monitor live process creation rate and free/used memory with two second interval printing timestamps and using GBs for output values in CSV format:
    <br/>
    <b>
     <br/>
     $
     <a href="/man/man1/pmrep.1.html">
      pmrep
     </a>
     -p -b GB -t 2sec -o csv kernel.all.sysfork mem.util.free mem.util.used
    </b>
   </td>
  </tr>
 </table>
 <table border="0" cellpadding="10" cellspacing="20" width="100%">
  <tr>
   <td width="70%">
    <br/>
    Monitor system metrics in a top-like window:
    <br/>
    <b>
     <br/>
     $
     <a href="/man/man1/pcp-atop.1.html">
      pcp atop
     </a>
    </b>
   </td>
  </tr>
 </table>
 <table border="0" cellpadding="10" cellspacing="20" width="100%">
  <tr>
   <td width="70%">
    <br/>
    Monitor system metrics in a sar-like (System Activity Report) manner:
    <br/>
    <b>
     <br/>
     $
     <a href="/man/man1/pcp-atopsar.1.html">
      pcp atopsar
     </a>
    </b>
   </td>
  </tr>
 </table>
 <table border="0" cellpadding="10" cellspacing="20" width="100%">
  <tr>
   <td width="70%">
    <br/>
    Monitor system metrics in a sar like fashion with two second interval from two different hosts:
    <br/>
    <b>
     <br/>
     $
     <a href="/man/man1/pmstat.1.html">
      pmstat
     </a>
     -t 2sec -h
     <font>
      acme1.com
     </font>
     -h
     <font>
      acme2.com
     </font>
    </b>
   </td>
  </tr>
 </table>
 <table border="0" cellpadding="10" cellspacing="20" width="100%">
  <tr>
   <td width="70%">
    <br/>
    Monitor system metrics in an iostat like fashion with two second interval:
    <br/>
    <b>
     <br/>
     $
     <a href="/man/man1/pmiostat.1.html">
      pmiostat
     </a>
     -t 2sec
    </b>
   </td>
  </tr>
 </table>
 <table border="0" cellpadding="10" cellspacing="20" width="100%">
  <tr>
   <td width="70%">
    <br/>
    Monitor performance metrics with a GUI application with two second default interval from two different hosts. Use
    <em>
     File-&gt;New Chart
    </em>
    to select metrics to be included in a new view and use
    <em>
     File-&gt;Open View
    </em>
    to use a predefined view:
    <br/>
    <b>
     <br/>
     $
     <a href="/man/man1/pmchart.1.html">
      pmchart
     </a>
     -t 2sec -h
     <font>
      acme1.com
     </font>
     -h
     <font>
      acme2.com
     </font>
    </b>
   </td>
  </tr>
 </table>
 <a name="retro">
 </a>
 <h3>
  Retrospective Performance Analysis
 </h3>
 <p>
  PCP archive logs are located under
  <tt>
   /var/log/pcp/pmlogger/
  </tt>
  <b>
   <font>
    hostname
   </font>
  </b>
  , and the archive names indicate the time they cover. Archives are self-contained, and machine- and version-independent so they can be transfered to any machine for offline analysis.
 </p>
 <table border="0" cellpadding="10" cellspacing="20" width="100%">
  <tr>
   <td width="70%">
    <br/>
    Check the host, timezone and the time period an archive covers:
    <br/>
    <b>
     <br/>
     $
     <a href="/man/man1/pmdumplog.1.html">
      pmdumplog
     </a>
     -L acme.com/20140902
    </b>
   </td>
  </tr>
 </table>
 <table border="0" cellpadding="10" cellspacing="20" width="100%">
  <tr>
   <td width="70%">
    <br/>
    Check PCP configuration at the time when an archive was created:
    <br/>
    <b>
     <br/>
     $
     <a href="/man/man1/pcp.1.html">
      pcp
     </a>
     -a acme.com/20140902
    </b>
   </td>
  </tr>
 </table>
 <table border="0" cellpadding="10" cellspacing="20" width="100%">
  <tr>
   <td width="70%">
    <br/>
    Display all enabled performance metrics at the time when an archive was created:
    <br/>
    <b>
     <br/>
     $
     <a href="/man/man1/pminfo.1.html">
      pminfo
     </a>
     -a acme.com/20140902
    </b>
   </td>
  </tr>
 </table>
 <table border="0" cellpadding="10" cellspacing="20" width="100%">
  <tr>
   <td width="70%">
    <br/>
    Display detailed information about a performance metric at the time when an archive was created:
    <br/>
    <b>
     <br/>
     $
     <a href="/man/man1/pminfo.1.html">
      pminfo
     </a>
     -df mem.freemem -a acme.com/20140902
    </b>
   </td>
  </tr>
 </table>
 <table border="0" cellpadding="10" cellspacing="20" width="100%">
  <tr>
   <td width="70%">
    <br/>
    Dump past disk write operations per partition in an archive using fixed point notation (use
    <em>
     -i
    </em>
    instance to list only certain metrics and
    <em>
     -r
    </em>
    for raw values):
    <br/>
    <b>
     <br/>
     $
     <a href="/man/man1/pmval.1.html">
      pmval
     </a>
     -f 3 disk.partitions.write -a acme.com/20140902
    </b>
   </td>
  </tr>
 </table>
 <table border="0" cellpadding="10" cellspacing="20" width="100%">
  <tr>
   <td width="70%">
    <br/>
    Replay past disk write operations per partition in an archive with two second interval using fixed point notation between 9 AM and 10 AM (use full dates with syntax like
    <em>
     @"2014-08-20 14:00:00"
    </em>
    ):
    <br/>
    <b>
     <br/>
     $
     <a href="/man/man1/pmval.1.html">
      pmval
     </a>
     -d -t 2sec -f 3 disk.partitions.write -S @09:00 -T @10:00 -a acme.com/20140902
    </b>
   </td>
  </tr>
 </table>
 <table border="0" cellpadding="10" cellspacing="20" width="100%">
  <tr>
   <td width="70%">
    <br/>
    Calculate average values of performance metrics in an archive between 9 AM / 10 AM using table like formatting including the time of minimum/maximum value and the actual minimum/maximum value:
    <br/>
    <b>
     <br/>
     $
     <a href="/man/man1/pmlogsummary.1.html">
      pmlogsummary
     </a>
     -HlfiImM -S @09:00 -T @10:00 acme.com/20140902 disk.partitions.write mem.freemem
    </b>
   </td>
  </tr>
 </table>
 <table border="0" cellpadding="10" cellspacing="20" width="100%">
  <tr>
   <td width="70%">
    <br/>
    Dump past CPU load, memory usage, and disk write operations per partition in an archive averaged over 10 minute interval with fixed columns between 9 AM and 10 AM:
    <br/>
    <b>
     <br/>
     $
     <a href="/man/man1/pmdumptext.1.html">
      pmdumptext
     </a>
     -Xlimu -t 10m -S @09:00 -T @10:00 'kernel.all.load[1]' 'mem.util.used' 'disk.partitions.write' -a acme.com/20140902
    </b>
   </td>
  </tr>
 </table>
 <table border="0" cellpadding="10" cellspacing="20" width="100%">
  <tr>
   <td width="70%">
    <br/>
    Replay
    <a href="/man/man8/vmstat.8.html">
     vmstat
    </a>
    like metrics (using a customizable metricset definition from the
    <a href="/man/man5/pmrep.conf.5.html">
     pmrep.conf
    </a>
    configuration file) from an archive on every full 5 minutes using UTC as timezone:
    <br/>
    <b>
     <br/>
     $
     <a href="/man/man1/pmrep.1.html">
      pmrep
     </a>
     -a acme.com/20140902 -A 5min -t 5min -Z UTC :vmstat
    </b>
   </td>
  </tr>
 </table>
 <table border="0" cellpadding="10" cellspacing="20" width="100%">
  <tr>
   <td width="70%">
    <br/>
    Summarize differences in past performance metrics between two archives, comparing 2 AM / 3 AM in the first archive to 9 AM / 10 AM in the second archive (grep for
    <em>
     '+'
    </em>
    to quickly see values which were zero during the first period):
    <br/>
    <b>
     <br/>
     $
     <a href="/man/man1/pmdiff.1.html">
      pmdiff
     </a>
     -S @02:00 -T @03:00 -B @09:00 -E @10:00 acme.com/20140902 acme.com/20140901
    </b>
   </td>
  </tr>
 </table>
 <table border="0" cellpadding="10" cellspacing="20" width="100%">
  <tr>
   <td width="70%">
    <br/>
    Replay past system metrics in an archive in a top-like window starting 9 AM:
    <br/>
    <b>
     <br/>
     $
     <a href="/man/man1/pcp-atop.1.html">
      pcp atop
     </a>
     -b 09:00 -r acme.com/20140902
     <br/>
     $
     <a href="/man/man1/pcp-atop.1.html">
      pcp
     </a>
     -S @09:00 -a acme.com/20140902 atop
    </b>
   </td>
  </tr>
 </table>
 <table border="0" cellpadding="10" cellspacing="20" width="100%">
  <tr>
   <td width="70%">
    <br/>
    Dump past system metrics in a sar like fashion averaged over 10 minute interval in an archive between 9 AM and 10 AM:
    <br/>
    <b>
     <br/>
     $
     <a href="/man/man1/pmstat.1.html">
      pmstat
     </a>
     -t 10m -S @09:00 -T @10:00 -a acme.com/20140902
    </b>
   </td>
  </tr>
 </table>
 <table border="0" cellpadding="10" cellspacing="20" width="100%">
  <tr>
   <td width="70%">
    <br/>
    Dump past system metrics in an
    <a href="http://man7.org/linux/man-pages/man1/iostat.1.html">
     iostat(1)
    </a>
    like fashion averaged over one hour interval in an archive:
    <br/>
    <b>
     <br/>
     $
     <a href="/man/man1/pmiostat.1.html">
      pmiostat
     </a>
     -t 1h -a acme.com/20140902
    </b>
   </td>
  </tr>
 </table>
 <table border="0" cellpadding="10" cellspacing="20" width="100%">
  <tr>
   <td width="70%">
    <br/>
    Dump past system metrics in a
    <a href="http://man7.org/linux/man-pages/man1/free.1.html">
     free(1)
    </a>
    like fashion at a specific historical time offset:
    <br/>
    <b>
     <br/>
     $
     <a href="/man/man1/pcp.1.html">
      pcp
     </a>
     -a acme.com/20140902 -O @10:02 free
    </b>
   </td>
  </tr>
 </table>
 <table border="0" cellpadding="10" cellspacing="20" width="100%">
  <tr>
   <td width="70%">
    <br/>
    Replay performance metrics with a GUI application with two second default interval in an archive between 9 AM and 10 AM. Use
    <em>
     File-&gt;New Chart
    </em>
    to select metrics to be included in a new view and use
    <em>
     File-&gt;Open View
    </em>
    to use a predefined view:
    <br/>
    <b>
     <br/>
     $
     <a href="/man/man1/pmchart.1.html">
      pmchart
     </a>
     -t 2sec -S @09:00 -T @10:00 -a acme.com/20140902
    </b>
   </td>
  </tr>
 </table>
 <table border="0" cellpadding="10" cellspacing="20" width="100%">
  <tr>
   <td width="70%">
    <br/>
    Merge several archives as a new combined archive (see the manual page how to write configuration file to collect only certain metrics):
    <br/>
    <b>
     <br/>
     $
     <a href="/man/man1/pmlogextract.1.html">
      pmlogextract
     </a>
     &lt;archive1&gt; &lt;archive2&gt; &lt;newarchive&gt;
    </b>
   </td>
  </tr>
 </table>
 <a name="visual">
 </a>
 <h3>
  Visualizing iostat and sar Data
 </h3>
 <p>
  <a href="http://man7.org/linux/man-pages/man1/iostat.1.html">
   iostat
  </a>
  and
  <a href="http://man7.org/linux/man-pages/man1/sar.1.html">
   sar
  </a>
  data can be imported as PCP archives which then allows inspecting and visualizing the data with PCP tools. The
  <a href="/man/man1/iostat2pcp.1.html">
   iostat2pcp(1)
  </a>
  importer is in the
  <em>
   pcp-import-iostat2pcp
  </em>
  package and the
  <a href="/man/man1/sar2pcp.1.html">
   sar2pcp(1)
  </a>
  importer is in the
  <em>
   pcp-import-sar2pcp
  </em>
  package.
 </p>
 <table border="0" cellpadding="10" cellspacing="20" width="100%">
  <tr>
   <td width="70%">
    <br/>
    Import iostat data to a new PCP archive and visualize it:
    <br/>
    <b>
     <br/>
     $
     <a href="http://man7.org/linux/man-pages/man1/iostat.1.html">
      iostat
     </a>
     -t -x 2 &gt; iostat.out
     <br/>
     $
     <a href="/man/man1/iostat2pcp.1.html">
      iostat2pcp
     </a>
     iostat.out iostat.pcp
     <br/>
     $
     <a href="/man/man1/pmchart.1.html">
      pmchart
     </a>
     -t 2sec -a iostat.pcp
    </b>
   </td>
  </tr>
 </table>
 <table border="0" cellpadding="10" cellspacing="20" width="100%">
  <tr>
   <td width="70%">
    <br/>
    Import sar data from an existing sar archive to a new PCP archive and visualize it (sar logs are under
    <tt>
     /var/log/sysstat
    </tt>
    on Debian/Ubuntu):
    <br/>
    <b>
     <br/>
     $
     <a href="/man/man1/sar2pcp.1.html">
      sar2pcp
     </a>
     /var/log/sa/sa15 sar.pcp
     <br/>
     $
     <a href="/man/man1/pmchart.1.html">
      pmchart
     </a>
     -t 2sec -a sar.pcp
    </b>
   </td>
  </tr>
 </table>
 <a name="processes">
 </a>
 <h1>
  Process Level Performance Monitoring
 </h1>
 <p>
  PCP provides details of each running process via the standard PCP interfaces and tools on the localhost but due to security and performance considerations, most of the process related information is not stored in archive logs by default. Also for security reasons, only root can access some details of running processes of other users.
 </p>
 <p>
  Custom application instrumentation is possible with the Memory Mapped Value (MMV) PMDA.
  <a name="processmon">
  </a>
 </p>
 <h3>
  Live and Retrospective Process Monitoring
 </h3>
 <table border="0" cellpadding="10" cellspacing="20" width="100%">
  <tr>
   <td width="70%">
    <br/>
    Display all the available process related metrics:
    <br/>
    <b>
     <br/>
     $
     <a href="/man/man1/pminfo.1.html">
      pminfo
     </a>
     proc
    </b>
   </td>
  </tr>
 </table>
 <table border="0" cellpadding="10" cellspacing="20" width="100%">
  <tr>
   <td width="70%">
    <br/>
    Monitor the number of open file descriptors of the process 1234:
    <br/>
    <b>
     <br/>
     $
     <a href="/man/man1/pmval.1.html">
      pmval
     </a>
     -t 2sec 'proc.fd.count[1234]'
    </b>
   </td>
  </tr>
 </table>
 <table border="0" cellpadding="10" cellspacing="20" width="100%">
  <tr>
   <td width="70%">
    <br/>
    Monitor the CPU time, memory usage (RSS), and the number of threads of the process 1234:
    <br/>
    <b>
     <br/>
     $
     <a href="/man/man1/pmdumptext.1.html">
      pmdumptext
     </a>
     -Xlimu -t 2sec 'proc.psinfo.utime[1234]' 'proc.memory.rss[1234]' 'proc.psinfo.threads[1234]'
    </b>
   </td>
  </tr>
 </table>
 <table border="0" cellpadding="10" cellspacing="20" width="100%">
  <tr>
   <td width="70%">
    <br/>
    Monitor all outgoing network metrics for the wlan0 interface:
    <br/>
    <b>
     <br/>
     $
     <a href="/man/man1/pmrep.1.html">
      pmrep
     </a>
     -i wlan0 -v network.interface.out
    </b>
   </td>
  </tr>
 </table>
 <table border="0" cellpadding="10" cellspacing="20" width="100%">
  <tr>
   <td width="70%">
    <br/>
    Display all the available process related metrics in an archive:
    <br/>
    <b>
     <br/>
     $
     <a href="/man/man1/pminfo.1.html">
      pminfo
     </a>
     proc -a acme.com/20140902
    </b>
   </td>
  </tr>
 </table>
 <table border="0" cellpadding="10" cellspacing="20" width="100%">
  <tr>
   <td width="70%">
    <br/>
    Display the number of running processes on 2014-08-20 14:00:
    <br/>
    <b>
     <br/>
     $
     <a href="/man/man1/pmval.1.html">
      pmval
     </a>
     -s 1 -S @"2014-08-20 14:00" proc.nprocs -a acme.com/20140820
    </b>
   </td>
  </tr>
 </table>
 <a name="hotproc">
 </a>
 <h3>
  Monitoring “Hot” Processes with Hotproc
 </h3>
 <p>
  It is also possible to monitor “hot” or “interesting” processes by name, for example all processes of which command name is
  <tt>
   java
  </tt>
  or
  <tt>
   python
  </tt>
  . This monitoring of “hot” processes can also be enabled or disabled based on certain criterias or from the command line on the fly. The metrics will be available under the namespace
  <em>
   hotproc
  </em>
  .
 </p>
 <p>
  Configuring processes to be monitored constantly using the
  <em>
   hotproc
  </em>
  namespace can be done using the configuration file
  <tt>
   /var/lib/pcp/pmdas/proc/hotproc.conf
  </tt>
  - see the
  <a href="/man/man1/pmdaproc.1.html">
   pmdaproc(1)
  </a>
  manual page for details. This allows monitoring these processes regardless of their PIDs and also logging the metrics easily.
 </p>
 <table border="0" cellpadding="10" cellspacing="20" width="100%">
  <tr>
   <td width="70%">
    <br/>
    Enable monitoring of all Java instances on the fly and display all the collected metrics:
    <br/>
    <b>
     <br/>
     #
     <a href="/man/man1/pmstore.1.html">
      pmstore
     </a>
     hotproc.control.config 'fname == "java"'
     <br/>
     #
     <a href="/man/man1/pminfo.1.html">
      pminfo
     </a>
     -f hotproc
    </b>
   </td>
  </tr>
 </table>
 <a name="instrument">
 </a>
 <h3>
  Application Instrumentation
 </h3>
 <p>
  Applications can be instrumented in the PCP world by using Memory Mapped Values (MMVs).
  <a href="/man/man1/pmdammv.1.html">
   pmdammv
  </a>
  is a PMDA which exports application level performance metrics using memory mapped files. It offers an extremely low overhead instrumentation facility that is well-suited to long running, mission critical applications where it is desirable to have performance metrics and availability information permanently enabled.
 </p>
 <p>
  Application to be instrumented with MMV need to be PCP MMV aware, APIs are available for several languages including C, C++, Perl, and Python. Java applications may use the separate
  <a href="https://github.com/performancecopilot/parfait">
   Parfait
  </a>
  class library for enabling MMV.
 </p>
 <p>
  See the
  <a href="https://pcp.io/doc/pcp-programmers-guide.pdf">
   Performance Co-Pilot Programmer's Guide PDF
  </a>
  for more information about application instrumentation.
  <a name="pmie">
  </a>
 </p>
 <h1>
  Performance Metrics Inference
 </h1>
 <p>
  Performance Metrics Inference Engine (
  <a href="/man/man1/pmie.1.html">
   pmie(1)
  </a>
  ) can evaluate rules and generate alarms, run scripts, or automate system management tasks based on live or past performance metrics.
 </p>
 <table border="0" cellpadding="10" cellspacing="20" width="100%">
  <tr>
   <td width="70%">
    <br/>
    To enable and start PMIE:
    <br/>
    <b>
     <br/>
     # systemctl enable pmie
     <br/>
     # systemctl start pmie
    </b>
   </td>
  </tr>
 </table>
 <p>
  To enable the monitoring host to run PMIE for collector hosts, add each host to the
  <tt>
   /etc/pcp/pmie/control
  </tt>
  configuration file.
 </p>
 <table border="0" cellpadding="10" cellspacing="20" width="100%">
  <tr>
   <td width="70%">
    <br/>
    Enable monitoring of metrics from remote host
    <b>
     acme.com
    </b>
    :
    <b>
     <br/>
     # echo acme.com n PCP_LOG_DIR/pmie/acme.com -c config.acme.com
     <br/>
     <br/>
     # systemctl restart pmie
    </b>
   </td>
  </tr>
 </table>
 <p>
  Some examples in plain English describing what could be done with PMIE:
 </p>
 <ul>
  <li>
   If the number of IP received packets exceeds a threshold run a script to adjust firewall rules to limit the incoming traffic
  </li>
  <li>
   If 3 out of 4 consecutive samples taken every minute of disk operations exceeds a threshold between 9 AM and 5 PM send an email and write a system log message
  </li>
  <li>
   If all hosts in a group have CPU load over a threshold for more than 10 minutes or they have more application processes running than a threshold limit generate an alarm and run a script to tune the application
  </li>
 </ul>
 <table border="0" cellpadding="10" cellspacing="20" width="100%">
  <tr>
   <td width="70%">
    <br/>
    This example shows a PMIE script, checks its syntax, runs it against an archive, and prints a simple message if more than 5 GB of memory was in use between 9 AM and 10 AM using one minute sampling interval:
    <br/>
    <b>
     <br/>
     $ cat pmie.ex
    </b>
    <pre><b>bloated = ( mem.util.used &gt; 5 Gbyte )
      -&gt; print "%v memory used on %h!"</b></pre>
    <b>
     <br/>
     $
     <a href="/man/man1/pmie.1.html">
      pmie
     </a>
     -C pmie.ex
     <br/>
     $
     <a href="/man/man1/pmie.1.html">
      pmie
     </a>
     -t 1min -c pmie.ex -S @09:00 -T @10:00 -a acme.com/20140820
    </b>
   </td>
  </tr>
 </table>
 <a name="pmseries">
 </a>
 <h1>
  Fast, Scalable Time Series Querying
 </h1>
 <p>
  Performance Metrics Series (
  <a href="/man/man1/pmseries.1.html">
   pmseries(1)
  </a>
  ) works with local pmlogger and
  <a href="http://redis.io">
   Redis
  </a>
  servers to allow fast, scalable performance queries spanning multiple hosts.
 </p>
 <table border="0" cellpadding="10" cellspacing="20" width="100%">
  <tr>
   <td width="70%">
    <br/>
    To enable and start PMIE:
    <br/>
    <b>
     <br/>
     # systemctl enable pmlogger pmproxy redis
     <br/>
     # systemctl start pmlogger pmproxy redis
    </b>
   </td>
  </tr>
 </table>
 <p>
  Redis can be run standalone or in large, highly available setups.
It is also provided as a scalable service by many cloud vendors.
 </p>
 <p>
  The metrics indexing process is designed to spread data across
multiple Redis nodes for improved query performance, so adding more
nodes can significantly improve performance.
 </p>
 <p>
  Examples of the
  <a href="/man/man1/pmseries.1.html">
   pmseries
  </a>
  query language can be found on the man page.
These queries can be executed from the command line utility, or from
the
  <a href="https://github.com/performancecopilot/grafana-pcp">
   grafana-pcp
  </a>
  plugin for Grafana (see the
  <a href="#web">
   PCP Web Services
  </a>
  section below).
  <a name="web">
  </a>
 </p>
 <h1>
  PCP Web Services
 </h1>
 <a name="pmproxy">
 </a>
 <h3>
  Performance Metrics REST APIs
 </h3>
 <p>
  The Performance Metrics Proxy Daemon (
  <a href="/man/man1/pmproxy.1.html">
   pmproxy(1)
  </a>
  ) is a front-end to both PMCD and PCP archives, providing a REST API service (over HTTP/JSON) suitable for use by web-based tools wishing to access performance data over HTTP or HTTPS. Custom applications can access all the available PCP information using this method, including custom metrics generated by custom PMDAs.
 </p>
 <table border="0" cellpadding="10" cellspacing="20" width="100%">
  <tr>
   <td width="70%">
    <br/>
    To install the PCP REST APIs service:
    <br/>
    <b>
     <br/>
     # systemctl enable pmproxy
     <br/>
     # systemctl start pmproxy
    </b>
   </td>
  </tr>
 </table>
 <a name="grafana">
 </a>
 <h3>
  Web Interface for Performance Metrics
 </h3>
 <p>
  <a href="https://grafana.com/">
   Grafana
  </a>
  is the recommended web interface for accessing PCP performance metrics over HTTP.
 </p>
 <table border="0" cellpadding="10" cellspacing="20" width="100%">
  <tr>
   <td width="70%">
    <br/>
    To install the PCP REST APIs service:
    <br/>
    <b>
     <br/>
     # systemctl enable grafana-server
     <br/>
     # systemctl start grafana-server
    </b>
   </td>
  </tr>
 </table>
 <p>
  After installing the PCP REST API services as described above, install the
  <a href="https://github.com/performancecopilot/grafana-pcp">
   grafana-pcp
  </a>
  package and then point a browser toward
  <a href="http://localhost:3000">
   http://localhost:3000
  </a>
  .
  <a name="derived">
  </a>
 </p>
 <h1>
  Derived Metrics
 </h1>
 <p>
  PCP provides a wide range of performance metrics but still in some cases the readily available metrics may not exactly provide what is needed. Derived metrics (see
  <a href="/man/man3/pmloadderivedconfig.3.html">
   pmLoadDerivedConfig(3)
  </a>
  ) may be used to extend the available metrics with new (derived) metrics by using simple arithmetic expressions (see
  <a href="/man/man3/pmregisterderived.3.html">
   pmRegisterDerived(3)
  </a>
  ).
 </p>
 <p>
  The following example illustrates how to define corresponding metrics which are displayed by
  <kbd>
   sar -d
  </kbd>
  but are not provided by default by PCP:
 </p>
 <table border="0" cellpadding="10" cellspacing="20" width="100%">
  <tr>
   <td width="70%">
    <br/>
    Create a file containing definitions of derived metrics and point PCP_DERIVED_CONFIG to it when running PCP utilities:
    <b>
     <br/>
     $ cat ./pcp-deriv-metrics.conf
     <br/>
     disk.dev.avqsz = disk.dev.read_rawactive + disk.dev.write_rawactive
     <br/>
     disk.dev.avrqsz = 2 * rate(disk.dev.total_bytes) / rate(disk.dev.total)
     <br/>
     disk.dev.await = 1000 * (rate(disk.dev.read_rawactive) + rate(disk.dev.write_rawactive)) / rate(disk.dev.total)
     <br/>
     $ export PCP_DERIVED_CONFIG=./pcp-deriv-metrics.conf
     <br/>
     $
     <a href="/man/man1/pmval.1.html">
      pmval
     </a>
     -t 2sec -f 3 disk.dev.avqsz
     <br/>
     $
     <a href="/man/man1/pmval.1.html">
      pmval
     </a>
     -t 2sec -f 3 disk.dev.avrqsz -h acme.com
     <br/>
     $
     <a href="/man/man1/pmval.1.html">
      pmval
     </a>
     -t 2sec -f 3 disk.dev.await -a acme.com/20140902
    </b>
   </td>
  </tr>
 </table>
 <table border="0" cellpadding="10" cellspacing="20" width="100%">
  <tr>
   <td width="70%">
    <br/>
    Define a derived metric on the command line and monitor it with standard metrics:
    <b>
     <br/>
     $
     <a href="/man/man1/pmrep.1.html">
      pmrep
     </a>
     -t 2sec -p -b MB -e "mem.util.allcache = mem.util.bufmem + mem.util.cached + mem.util.slab" mem.util.free mem.util.allcache mem.util.used
    </b>
   </td>
  </tr>
 </table>
 <a name="custom">
 </a>
 <h1>
  Customizing and Extending PCP
 </h1>
 <p>
  PCP PMDAs offer a way for administrators and developers to customize and extend the default PCP installation. The pcp-libs-devel package contains all the needed development related examples, headers, and libraries. New PMDAs can easily be added, below is a quick list of references for starting development:
 </p>
 <ul>
  <li>
   Some examples exist below
   <tt>
    /var/lib/pcp/pmdas/
   </tt>
   - the simple, sample, trivial and txmon PMDAs are easy to read PMDAs.
   <ul>
    <li>
     The simple and trivial PMDAs provide implementations in C, Perl and Python.
    </li>
   </ul>
  </li>
  <li>
   A simple command line monitor tool is
   <tt>
    /usr/share/pcp/demos/pmclient
   </tt>
   (C language).
  </li>
  <li>
   Good initial Python monitor examples are
   <tt>
    /usr/libexec/pcp/bin/pcp/pcp-*
   </tt>
   (Fedora/RHEL) or
   <tt>
    /usr/lib/pcp/bin/pcp-*
   </tt>
   (Debian/Ubuntu).
   <ul>
    <li>
     Slightly more complex examples are the pcp-free, pcp-mpstat, pcp-numastat commands.
    </li>
   </ul>
  </li>
 </ul>
 <a name="next">
 </a>
 <h1>
  Additional Information
 </h1>
 <ul>
  <li>
   <a href="https://pcp.io/">
    https://pcp.io/
   </a>
   - PCP home page
  </li>
  <li>
   <a href="https://pcp.io/presentations.html">
    https://pcp.io/presentations.html
   </a>
   - PCP Presentations
  </li>
  <li>
   <a href="https://pcp.io/doc/pcp-users-and-administrators-guide.pdf">
    https://pcp.io/doc/pcp-users-and-administrators-guide.pdf
   </a>
   - Performance Co-Pilot User's and Administrator's Guide PDF
  </li>
  <li>
   <a href="https://pcp.io/doc/pcp-programmers-guide.pdf">
    https://pcp.io/doc/pcp-programmers-guide.pdf
   </a>
   - Performance Co-Pilot Programmer's Guide PDF
  </li>
 </ul>
 <p>
  <br/>
 </p>
 
</div>
</div>
</div>
</div>
</div>
<footer class='global-footer is-typeset'>
<div class='row-parent'>
<div class='row'>
<section class='row__colspaced'>
<div class='colspan12-3 colspan8-2 colspan6-2 colspan2-2 as-grid with-gutter'>
<div class='col__module'>
<h4>Main Menu</h4>
<ul>
<li>
<a href='/features.html'>Features</a>
</li>
<li>
<a href='/documentation.html'>Documentation</a>
</li>
<li>
<a class='download' href='/download.html'>Download</a>
</li>
</ul>
</div>
</div>
<div class='colspan12-3 colspan8-2 colspan6-2 colspan2-2 as-grid with-gutter'>
<div class='col__module'>
<h4>Developers</h4>
<ul>
<li>
<a href='https://github.com/performancecopilot/pcp/issues'>Report an issue</a>
</li>
<li>
<a href='https://github.com/performancecopilot/pcp/projects/1'>Roadmap</a>
</li>
<li>
<a href='/community.html'>Contributing</a>
</li>
<li>
<a href='/team.html'>Team</a>
</li>
</ul>
</div>
</div>
<div class='colspan12-3 colspan8-2 colspan6-2 colspan2-2 as-grid with-gutter'>
<div class='col__module'>
<h4>About</h4>
<ul>
<li>
<a href='/testimonials.html'>Testimonials</a>
</li>
<li>
<a href='/faq.html'>FAQ</a>
</li>
<li>
<a href='/website.html'>Website</a>
</li>
</ul>
</div>
</div>
<div class='colspan12-3 colspan8-2 colspan6-2 colspan2-2 as-grid with-gutter'>
<div class='col__module'>
<h4>Get Social</h4>
<ul>
<li>
<a class='twitter' href='https://twitter.com/performancepcp' rel='external'>Twitter</a>
</li>
<li>
<a class='github' href='https://github.com/performancecopilot' rel='external'>Github</a>
</li>
</ul>
</div>
</div>
</section>
</div>
<div class='row'>
<div class='colspan2-2'>
<p class='legal'>
This website is Copyright &copy; 2000-2004 Silicon Graphics Inc, 2007-2010 Aconex, 2012-2020 Red Hat
</p>
</div>
</div>
</div>
</footer>

</body>
</html>
